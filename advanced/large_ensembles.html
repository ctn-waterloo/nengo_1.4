

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Generating large ensembles &#8212; Nengo 1.4 1.4 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Accelerating simulations with GPUs" href="gpu.html" />
    <link rel="prev" title="Running Nengo in Matlab" href="matlab.html" />
<link rel="stylesheet" type="text/css" href="../_static/custom.css">


  
   

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="gpu.html" title="Accelerating simulations with GPUs"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="matlab.html" title="Running Nengo in Matlab"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Nengo 1.4 1.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Advanced usage</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
        <a href="
    ../index.html" class="text-logo">Nengo 1.4</a>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos/index.html">Video tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Written tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/index.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripting/index.html">Scripting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="layout.html">Interactive plots layout files</a></li>
<li class="toctree-l2"><a class="reference internal" href="dragndrop.html">Creating a drag and drop template</a></li>
<li class="toctree-l2"><a class="reference internal" href="experiments.html">Running experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="matlab.html">Running Nengo in Matlab</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Generating large ensembles</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.html">Accelerating simulations with GPUs</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipython_notebook.html">Integrating with IPython Notebook</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../nef_algorithm.html">The NEF Algorithm</a></li>
</ul>

    
  </div>
</div>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="index.html">Advanced usage</a></li>
              
              <li>Generating large ensembles</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="generating-large-ensembles">
<h1>Generating large ensembles<a class="headerlink" href="#generating-large-ensembles" title="Permalink to this headline">¶</a></h1>
<p>With the standard Nengo install,
creating neural populations
with more than 500 neurons takes a very long time.
This is because Nengo needs to solve for the decoders,
which involves (pseudo-)inverting an <span class="math">\(N \times N\)</span> matrix,
where <span class="math">\(N\)</span> is the number of neurons.</p>
<p>By default, Nengo is a pure Java application,
so in order to perform this matrix pseudo-inversion,
it uses a Java implementation of singular value decomposition (SVD),
which is quite slow.
To speed this up,
we can tell Nengo to call out to another program (Python)
to perform this operation.</p>
<p>To ensure that this process works properly,
follow these steps.</p>
<div class="section" id="install-python-scipy-and-numpy">
<h2>1. Install Python, SciPy, and NumPy<a class="headerlink" href="#install-python-scipy-and-numpy" title="Permalink to this headline">¶</a></h2>
<p>Python is a freely available programming language,
and it has two libraries (SciPy and NumPy)
which provide most of the high-speed
matrix operations found in Matlab.</p>
<p>For detailed instructions on installing these tools
on all operating systems, <a class="reference external" href="https://www.nengo.ai/download.html#installing-python-and-numpy">go here</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Nengo 1.4 is only tested with Python 2.7.
Python 3.x may work, but if you run into problems,
try downgrading to Python 2.7.</p>
</div>
</div>
<div class="section" id="tell-nengo-where-python-is">
<h2>2. Tell Nengo where Python is<a class="headerlink" href="#tell-nengo-where-python-is" title="Permalink to this headline">¶</a></h2>
<p>For Linux and OS X,
Nengo should automatically be able to find Python to run it.
However, this seems not to be the case for some versions of Windows.
Under Windows, you will have to edit the file
<code class="docutils literal"><span class="pre">external/pseudoInverse.bat</span></code> by changing this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">pseudoInverse</span> <span class="o">%</span><span class="mi">1</span> <span class="o">%</span><span class="mi">2</span> <span class="o">%</span><span class="mi">3</span> <span class="o">%</span><span class="mi">4</span>
</pre></div>
</div>
<p>into this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">python27</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">pseudoInverse</span> <span class="o">%</span><span class="mi">1</span> <span class="o">%</span><span class="mi">2</span> <span class="o">%</span><span class="mi">3</span> <span class="o">%</span><span class="mi">4</span>
</pre></div>
</div>
<p>Where <code class="docutils literal"><span class="pre">C:\python27</span></code> is the directory
in which you installed Python.</p>
</div>
<div class="section" id="test">
<h2>3. Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<p>You should now be able to create larger ensembles in Nengo.
A population with 500 neurons should take 5 – 10 seconds.
1000 neurons should take 15 – 30 seconds.
The largest we recommend using this technique is 5000 neurons,
which may take up to half an hour.
As always, you can make use of
the <a class="reference internal" href="../scripting/speed.html"><span class="doc">quick</span></a> option
to re-use ensembles once they have been created.</p>
<p>To confirm that Nengo is using this faster approach,
you can examine the console output from Nengo.
This is the window Nengo is being run from,
and on Windows this is a black window
showing a lot of text as ensembles are created.
This is not the Script Console
at the bottom of the main Nengo window.</p>
<p>If the external script is working,
when you create an ensemble you should see something like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">INFO</span>  <span class="p">[</span><span class="n">Configuring</span> <span class="n">NEFEnsemble</span><span class="p">:</span><span class="n">ca</span><span class="o">.</span><span class="n">nengo</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Memory</span><span class="p">]:</span> <span class="n">Used</span><span class="p">:</span> <span class="mi">62454552</span> <span class="n">Total</span><span class="p">:</span> <span class="mi">101449728</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">810942464</span> <span class="p">(</span><span class="n">before</span> <span class="n">gamma</span><span class="p">)</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">Configuring</span> <span class="n">NEFEnsemble</span><span class="p">:</span><span class="n">ca</span><span class="o">.</span><span class="n">nengo</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Memory</span><span class="p">]:</span> <span class="n">Used</span><span class="p">:</span> <span class="mi">71208944</span> <span class="n">Total</span><span class="p">:</span> <span class="mi">101449728</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">810942464</span> <span class="p">(</span><span class="n">before</span> <span class="n">inverse</span><span class="p">)</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">Configuring</span> <span class="n">NEFEnsemble</span><span class="p">:</span><span class="n">ca</span><span class="o">.</span><span class="n">nengo</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Memory</span><span class="p">]:</span> <span class="n">Used</span><span class="p">:</span> <span class="mi">69374440</span> <span class="n">Total</span><span class="p">:</span> <span class="mi">164933632</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">810942464</span> <span class="p">(</span><span class="n">after</span> <span class="n">inverse</span><span class="p">)</span>
</pre></div>
</div>
<p>If the external script is not working,
when you create an ensemble you will see something like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">INFO</span>  <span class="p">[</span><span class="n">Configuring</span> <span class="n">NEFEnsemble</span><span class="p">:</span><span class="n">ca</span><span class="o">.</span><span class="n">nengo</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Memory</span><span class="p">]:</span> <span class="n">Used</span><span class="p">:</span> <span class="mi">108627944</span> <span class="n">Total</span><span class="p">:</span> <span class="mi">164933632</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">810942464</span> <span class="p">(</span><span class="n">before</span> <span class="n">gamma</span><span class="p">)</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">Configuring</span> <span class="n">NEFEnsemble</span><span class="p">:</span><span class="n">ca</span><span class="o">.</span><span class="n">nengo</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Memory</span><span class="p">]:</span> <span class="n">Used</span><span class="p">:</span> <span class="mi">108627944</span> <span class="n">Total</span><span class="p">:</span> <span class="mi">164933632</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">810942464</span> <span class="p">(</span><span class="n">before</span> <span class="n">inverse</span><span class="p">)</span>
<span class="n">File</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span> <span class="n">java</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">FileNotFoundException</span><span class="p">:</span> <span class="n">external</span>\<span class="n">matrix_</span><span class="o">-</span><span class="mf">3645035487712329947.</span><span class="n">inv</span> <span class="p">(</span><span class="n">The</span> <span class="n">system</span> <span class="n">cannot</span> <span class="n">find</span> <span class="n">the</span> <span class="n">file</span> <span class="n">specified</span><span class="p">)</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">Configuring</span> <span class="n">NEFEnsemble</span><span class="p">:</span><span class="n">ca</span><span class="o">.</span><span class="n">nengo</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">impl</span><span class="o">.</span><span class="n">WeightedCostApproximator</span><span class="p">]:</span> <span class="n">Using</span> <span class="mi">53</span> <span class="n">singular</span> <span class="n">values</span> <span class="k">for</span> <span class="n">pseudo</span><span class="o">-</span><span class="n">inverse</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">Configuring</span> <span class="n">NEFEnsemble</span><span class="p">:</span><span class="n">ca</span><span class="o">.</span><span class="n">nengo</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Memory</span><span class="p">]:</span> <span class="n">Used</span><span class="p">:</span> <span class="mi">75885904</span> <span class="n">Total</span><span class="p">:</span> <span class="mi">164933632</span> <span class="n">Max</span><span class="p">:</span> <span class="mi">810942464</span> <span class="p">(</span><span class="n">after</span> <span class="n">inverse</span><span class="p">)</span>
</pre></div>
</div>
<p>Nengo will still operate properly in this case,
though decoder solving will be slower.</p>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="matlab.html" title="previous chapter (use the left arrow)">Running Nengo in Matlab</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="gpu.html" title="next chapter (use the right arrow)">Accelerating simulations with GPUs</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="gpu.html" title="Accelerating simulations with GPUs"
             >next</a> |</li>
        <li class="right" >
          <a href="matlab.html" title="Running Nengo in Matlab"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Nengo 1.4 1.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Advanced usage</a> &#187;</li> 
      </ul>
    </div>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".toggle > *").hide();
      $(".toggle .header").show();
      $(".toggle .header").click(function() {
        $(this).parent().children().not(".header").toggle(400);
        $(this).parent().children(".header").toggleClass("open");
      });
    });
  </script>

<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2006-2017, Bryan Tripp & Centre for Theoretical Neuroscience, University of Waterloo. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>