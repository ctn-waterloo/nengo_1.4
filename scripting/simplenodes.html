

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Adding arbitary code to a model &#8212; Nengo 1.4 1.4 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Speeding up network creation" href="speed.html" />
    <link rel="prev" title="Configuring ensembles" href="ensembles.html" />
<link rel="stylesheet" type="text/css" href="../_static/custom.css">


  
   

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="speed.html" title="Speeding up network creation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ensembles.html" title="Configuring ensembles"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Nengo 1.4 1.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Scripting</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
        <a href="
    ../index.html" class="text-logo">Nengo 1.4</a>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videos/index.html">Video tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Written tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/index.html">Demos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Scripting</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basics.html">Introduction to scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="ensembles.html">Configuring ensembles</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adding arbitary code to a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="speed.html">Speeding up network creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="weights.html">Connection weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html">Tips and tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">API reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nef_algorithm.html">The NEF Algorithm</a></li>
</ul>

    
  </div>
</div>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="index.html">Scripting</a></li>
              
              <li>Adding arbitary code to a model</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="adding-arbitary-code-to-a-model">
<h1>Adding arbitary code to a model<a class="headerlink" href="#adding-arbitary-code-to-a-model" title="Permalink to this headline">¶</a></h1>
<p>Nengo models are composed of Nodes.
Each Node has Origins (outputs) and Terminations (inputs),
allowing them to be connected up to perform operations.
Nengo has built-in Node types for Neurons,
Ensembles (groups of Neurons), Networks, Arrays, and so on.
However, when creating a complex model,
we may want to create our own Node type.
This might be to provide custom input or output from a model,
or it can be used to have a non-neural component within a larger model.</p>
<p>Technically,
the only requirement for being a Node is that an object
supports the <code class="docutils literal"><span class="pre">ca.nengo.model.Node</span></code> interface.
However, for the mast majority of cases,
it is easier to make use of the <a class="reference internal" href="../python-api/nef/SimpleNode.html#nef.SimpleNode" title="nef.SimpleNode"><code class="xref py py-class docutils literal"><span class="pre">nef.SimpleNode</span></code></a> wrapper class.</p>
<div class="section" id="simplenode">
<h2>SimpleNode<a class="headerlink" href="#simplenode" title="Permalink to this headline">¶</a></h2>
<p>You create a <a class="reference internal" href="../python-api/nef/SimpleNode.html#nef.SimpleNode" title="nef.SimpleNode"><code class="xref py py-class docutils literal"><span class="pre">nef.SimpleNode</span></code></a> by subclassing and
defining methods to be called for
whatever Origins and Terminations you want for this object.
The functions you define will be called
once every time step (usually 0.001 seconds).
These functions can contain arbitrary code,
allowing you to implement anything you want to.
For example, the following code creates a Node that outputs a sine wave:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nef</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s1">&#39;Sine wave&#39;</span><span class="p">)</span>

<span class="c1"># define the SimpleNode</span>
<span class="k">class</span> <span class="nc">SineWave</span><span class="p">(</span><span class="n">nef</span><span class="o">.</span><span class="n">SimpleNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">origin_wave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)]</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SineWave</span><span class="p">(</span><span class="s1">&#39;wave&#39;</span><span class="p">))</span>

<span class="n">net</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;neurons&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># connect the SimpleNode to the group of neurons</span>
<span class="n">net</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">(</span><span class="s1">&#39;wave&#39;</span><span class="p">),</span> <span class="s1">&#39;neurons&#39;</span><span class="p">)</span>

<span class="n">net</span><span class="o">.</span><span class="n">add_to_nengo</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="outputs-a-k-a-origins">
<h2>Outputs (a.k.a. Origins)<a class="headerlink" href="#outputs-a-k-a-origins" title="Permalink to this headline">¶</a></h2>
<p>You can create as many outputs
as you want from a SimpleNode,
as long as each one has a distinct name.
Each origin consists of a single function
that will get called once per time-step
and must return an array of floats.</p>
<p>When defining this function,
it is often useful to know the current simulation time.
This can be accessed as <code class="docutils literal"><span class="pre">self.t</span></code>,
and is the time (in seconds)
of the beginning of the current time-step
(the end of the current time step is <code class="docutils literal"><span class="pre">self.t_end</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ManyOrigins</span><span class="p">(</span><span class="n">nef</span><span class="o">.</span><span class="n">SimpleNode</span><span class="p">):</span>

    <span class="c1"># an origin that is 0 for t &lt; 0.5 and 1 for t &gt;= 0.5</span>
    <span class="k">def</span> <span class="nf">origin_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># a triangle wave with period of 1.0 seconds</span>
    <span class="k">def</span> <span class="nf">origin_triangle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">%</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span>

    <span class="c1"># a sine wave and a cosine with frequency 10 Hz</span>
    <span class="k">def</span> <span class="nf">origin_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
</pre></div>
</div>
<p>When connecting a SimpleNode to other nodes,
we need to specify which origin we are connecting.
The name of the origin is determined by the function definition,
of the form <code class="docutils literal"><span class="pre">origin_&lt;name&gt;</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">many</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ManyOrigins</span><span class="p">(</span><span class="s1">&#39;many&#39;</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">many</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">(</span><span class="s1">&#39;triangle&#39;</span><span class="p">),</span> <span class="s1">&#39;A&#39;</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">many</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">),</span> <span class="s1">&#39;B&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="inputs-a-k-a-terminations">
<h2>Inputs (a.k.a. Terminations)<a class="headerlink" href="#inputs-a-k-a-terminations" title="Permalink to this headline">¶</a></h2>
<p>To provide input to a SimpleNode, we define terminations.
These are done in a similar manner as origins,
but these functions take an input value (usually denoted <code class="docutils literal"><span class="pre">x</span></code>),
which is an array of floats containing the input.</p>
<p>When definining the termination,
we also have to define the number of dimensions expected.
We do this by setting the <code class="docutils literal"><span class="pre">dimensions</span></code> parameter (which defaults to 1).
We can also specify the post-synaptic time constant
at this termination by setting the <code class="docutils literal"><span class="pre">pstc</span></code> parameter (default is None).</p>
<p>For example,
the following object takes a 5-dimensional input vector
and outputs the largest of the received values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Largest</span><span class="p">(</span><span class="n">nef</span><span class="o">.</span><span class="n">SimpleNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largest</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">termination_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pstc</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">origin_largest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">largest</span><span class="p">]</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s1">&#39;largest&#39;</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">make_input</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">largest</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Largest</span><span class="p">(</span><span class="s1">&#39;largest&#39;</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">largest</span><span class="o">.</span><span class="n">getTermination</span><span class="p">(</span><span class="s1">&#39;values&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When making a component like this,
make sure to define an initial value for <code class="docutils literal"><span class="pre">largest</span></code>
(or whatever internal parameter
is being used to map inputs to outputs)
inside the <code class="docutils literal"><span class="pre">init(self)</span></code> function.
This function will be called
before the origins are evaluated
so that there is a valid <code class="docutils literal"><span class="pre">self.largest</span></code> return value.</p>
</div>
</div>
<div class="section" id="arbitrary-code">
<h2>Arbitrary code<a class="headerlink" href="#arbitrary-code" title="Permalink to this headline">¶</a></h2>
<p>You can also define a function
that will be called every time step,
but which is <em>not</em> tied to a particular Origin or Termination.
This function is called <code class="docutils literal"><span class="pre">tick</span></code>.
Here is a simple example
where this function simply prints the current time:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Time</span><span class="p">(</span><span class="n">nef</span><span class="o">.</span><span class="n">SimpleNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s2">&quot;The current time in the simulation is: </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
</pre></div>
</div>
<p>As a more complex example,
here is a <code class="docutils literal"><span class="pre">tick</span></code> function
used to save spike raster information
to a text file while the simulation runs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SpikeSaver</span><span class="p">(</span><span class="n">nef</span><span class="o">.</span><span class="n">SimpleNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">,</span><span class="s1">&#39;a+&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">(</span><span class="s1">&#39;AXON&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getValues</span><span class="p">()</span><span class="o">.</span><span class="n">getValues</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%1.3f</span><span class="s2">,</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s1">&#39;Spike Saver example&#39;</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">saver</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SpikeSaver</span><span class="p">(</span><span class="s1">&#39;saver&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="ensembles.html" title="previous chapter (use the left arrow)">Configuring ensembles</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="speed.html" title="next chapter (use the right arrow)">Speeding up network creation</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="speed.html" title="Speeding up network creation"
             >next</a> |</li>
        <li class="right" >
          <a href="ensembles.html" title="Configuring ensembles"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Nengo 1.4 1.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Scripting</a> &#187;</li> 
      </ul>
    </div>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".toggle > *").hide();
      $(".toggle .header").show();
      $(".toggle .header").click(function() {
        $(this).parent().children().not(".header").toggle(400);
        $(this).parent().children(".header").toggleClass("open");
      });
    });
  </script>

<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2006-2017, Bryan Tripp & Centre for Theoretical Neuroscience, University of Waterloo. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>